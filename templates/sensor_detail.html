{% extends "base.html" %}

{% block title %}{{ sensor_name }} - TempPi{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mb-4">
            <i class="fas fa-thermometer-half"></i> {{ sensor_name }}
            <a href="/" class="btn btn-outline-secondary btn-sm float-end">
                <i class="fas fa-arrow-left"></i> Voltar
            </a>
        </h1>
    </div>
</div>

<!-- Controles do Gráfico -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <div class="row g-3 align-items-end">
                    <div class="col-md-3">
                        <label class="form-label">Período</label>
                        <select class="form-select" id="time-range">
                            <option value="1">Última 1 hora</option>
                            <option value="6">Últimas 6 horas</option>
                            <option value="24" selected>Últimas 24 horas</option>
                            <option value="72">Últimos 3 dias</option>
                            <option value="168">Última semana</option>
                        </select>
                    </div>
                    
                    <div class="col-md-3">
                        <button class="btn btn-primary" id="update-chart">
                            <i class="fas fa-sync-alt"></i> Atualizar
                        </button>
                        <button class="btn btn-success" id="auto-refresh" data-active="false">
                            <i class="fas fa-play"></i> Auto-refresh
                        </button>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="text-end">
                            <small class="text-muted">
                                <i class="fas fa-info-circle"></i> 
                                Última atualização: <span id="last-update">-</span>
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Gráficos -->
<div class="row mb-4">
    <!-- Gráfico de Temperatura -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-thermometer-half text-danger"></i> Temperatura</h5>
            </div>
            <div class="card-body">
                <canvas id="temperature-chart" width="400" height="300" style="height: 300px;"></canvas>
                <div class="mt-2">
                    <small class="text-muted">
                        <span class="badge bg-danger">Atual:</span> 
                        <span id="temp-current">-</span>°C
                        <span class="badge bg-info ms-2">Média:</span> 
                        <span id="temp-avg">-</span>°C
                    </small>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Gráfico de Pressão -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-tachometer-alt text-primary"></i> Pressão</h5>
            </div>
            <div class="card-body">
                <canvas id="pressure-chart" width="400" height="300" style="height: 300px;"></canvas>
                <div class="mt-2">
                    <small class="text-muted">
                        <span class="badge bg-primary">Atual:</span> 
                        <span id="pressure-current">-</span> bar
                        <span class="badge bg-info ms-2">Média:</span> 
                        <span id="pressure-avg">-</span> bar
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mb-4">
    <!-- Gráfico de Velocidade -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-tachometer-alt text-success"></i> Velocidade</h5>
            </div>
            <div class="card-body">
                <canvas id="velocity-chart" width="400" height="300" style="height: 300px;"></canvas>
                <div class="mt-2">
                    <small class="text-muted">
                        <span class="badge bg-success">Atual:</span> 
                        <span id="velocity-current">-</span> rpm
                        <span class="badge bg-info ms-2">Média:</span> 
                        <span id="velocity-avg">-</span> rpm
                    </small>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Estatísticas -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-chart-bar"></i> Estatísticas</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-6">
                        <div class="text-center p-3 border rounded mb-3">
                            <h6>Temperatura</h6>
                            <div>
                                <small>Min: <span id="temp-min" class="text-primary">-</span>°C</small><br>
                                <small>Max: <span id="temp-max" class="text-danger">-</span>°C</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="text-center p-3 border rounded mb-3">
                            <h6>Pressão</h6>
                            <div>
                                <small>Min: <span id="pressure-min" class="text-primary">-</span> bar</small><br>
                                <small>Max: <span id="pressure-max" class="text-danger">-</span> bar</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="text-center p-3 border rounded">
                            <h6>Velocidade</h6>
                            <div>
                                <small>Min: <span id="velocity-min" class="text-primary">-</span> rpm</small><br>
                                <small>Max: <span id="velocity-max" class="text-danger">-</span> rpm</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="text-center p-3 border rounded">
                            <h6>Dados</h6>
                            <div>
                                <small>Total: <span id="data-count">-</span></small><br>
                                <small>Período: <span id="data-period">-</span></small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Dados Recentes -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-list"></i> Dados Recentes</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>Temperatura</th>
                                <th>Pressão</th>
                                <th>Velocidade</th>
                                <th>Modo</th>
                            </tr>
                        </thead>
                        <tbody id="recent-data">
                            <!-- Carregado via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    const sensorName = "{{ sensor_name }}";
</script>
<script src="{{ url_for('static', filename='js/sensor_detail.js') }}"></script>
<style>
    /* Garantir altura fixa para os gráficos */
    .card-body canvas {
        max-height: 300px !important;
        height: 300px !important;
    }
    
    /* Container dos gráficos com altura fixa */
    .card-body {
        position: relative;
    }
    
    /* Responsividade para telas menores */
    @media (max-width: 768px) {
        .card-body canvas {
            height: 250px !important;
            max-height: 250px !important;
        }
    }
</style>
{% endblock %}
